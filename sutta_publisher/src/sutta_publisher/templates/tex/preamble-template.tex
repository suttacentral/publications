\usepackage[inner=1in, outer=1in, top=.8in, bottom=1.1in, papersize={6in,9in}]{geometry}
\usepackage{polyglossia}
\usepackage[12pt]{moresize}
\usepackage[utf8]{inputenc}
\usepackage{lastpage}%
\usepackage{soul}%
\usepackage{microtype}
\usepackage[]{tocbasic}
\usepackage{realscripts}
\usepackage{epigraph}%
\usepackage{setspace}%
\usepackage{sectsty}
\usepackage{fontspec}
\usepackage{luatexja-fontspec}
\usepackage[noadjust]{marginnote}
\usepackage[bottom]{footmisc}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{extramarks}

\setdefaultlanguage[]{english}
\setotherlanguage[script=Latin]{sanskrit}

% define fonts
% use until arno is available
%\setmainfont[Numbers=OldStyle]{EB Garamond}
%\newfontfamily\Semiboldsubheadfont[]{EB Garamond}
%\newfontfamily\Semiboldnormalfont[]{EB Garamond}

% when arno is available, uncomment these
%\setmainfont[Numbers=OldStyle]{Arno Pro}
%\newfontfamily\Semiboldsubheadfont[BoldFont = ArnoPro-SmbdSubhead,BoldItalicFont = ArnoPro-SmbdItalicSubhead]{Arno Pro Smbd}
%\newfontfamily\Semiboldnormalfont[BoldFont = ArnoPro-Smbd,BoldItalicFont = ArnoPro-SmbdItalic]{Arno Pro Smbd}
%\newfontfamily\MarginalFont[RawFeature=+subs]{Arno Pro}
%\renewcommand*{\marginfont}{\MarginalFont}

% use compact lists
\setitemize{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}
\setenumerate{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}
\setdescription{noitemsep}

% style ToC
\DeclareTOCStyleEntries[
  raggedentrytext,
  linefill=\hfill,
  numwidth=1em,
  numsep=1ex,
  dynnumwidth
]{tocline}{chapter,section,subsection,subsubsection,paragraph,subparagraph}
\DeclareTOCStyleEntries[
  indent=0pt,
  dynindent
]{tocline}{section,subsection,subsubsection,paragraph,subparagraph}

\let\oldcontentsline\contentsline
\newcommand{\nopagecontentsline}[3]{\oldcontentsline{#1}{#2}{}}

    \makeatletter
\renewcommand*\l@part[2]{%
  \ifnum \c@tocdepth >-2\relax
    \addpenalty{-\@highpenalty}%
    \addvspace{2.25em \@plus\p@}%
    \setlength\@tempdima{3em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      {\leavevmode
       \hspace*{\fill}\centering\large\scshape #1\hspace*{\fill}\llap{#2}}\par
       \nobreak
         \global\@nobreaktrue
         \everypar{\global\@nobreakfalse\everypar{}}%
    \endgroup
  \fi}
\makeatother

\makeatletter
\def\@pnumwidth{2em}
\makeatother

% global line height
\setstretch{1.05}

% allow linebreak after em-dash
\catcode`\—=13
\protected\def—{\unskip\textemdash\allowbreak}

% style headings with secsty
\chapterfont{\normalfont\centering}
\partfont{\normalfont\centering\caps}
\sectionfont{\normalfont}
\subsectionfont{\Semiboldsubheadfont}
\subsubsectionfont{\Semiboldsubheadfont}

% redefine paragraph and subparagraph headings to not be inline
\makeatletter
%%%%% Change the style of paragraph headings %%%%%
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
            {-2.5ex\@plus -1ex \@minus -.25ex}%
            {1.25ex \@plus .25ex}%
            {\noindent\Semiboldnormalfont\normalsize}}
%%%%% Change the style of subparagraph headings %%%%%
\renewcommand\subparagraph{\@startsection{subparagraph}{5}{\z@}%
            {-2.5ex\@plus -1ex \@minus -.25ex}%
            {1.25ex \@plus .25ex}% 
            {\noindent\Semiboldnormalfont\small}}
\makeatother

% titlepage
\newcommand*{\titlepageTranslationTitle}[1]{{\begin{center}\begin{large}{#1}\end{large}\end{center}}}
\newcommand*{\titlepageCreatorName}[1]{{\begin{center}\begin{normalsize}{#1}\end{normalsize}\end{center}}}

% halftitlepage
\newcommand*{\halftitlepageTranslationTitle}[1]{\setstretch{2.5}{\begin{center}\begin{Huge}\uppercase{\so{#1}}\end{Huge}\end{center}}}
\newcommand*{\halftitlepageTranslationSubtitle}[1]{\setstretch{1.2}{\begin{center}\begin{large}{#1}\end{large}\end{center}}}
% \newcommand*{\halftitlepageFleuron}[1]{{\begin{center}\begin{large}\ArnoProornmZero{{#1}}\end{large}\end{center}}}
\newcommand*{\halftitlepageByline}[1]{{\begin{center}\begin{normalsize}\textit{{#1}}\end{normalsize}\end{center}}}
\newcommand*{\halftitlepageCreatorName}[1]{{\begin{center}\begin{LARGE}{\caps{#1}}\end{LARGE}\end{center}}}
\newcommand*{\halftitlepageVolumeNumber}[1]{{\begin{center}\begin{normalsize}{#1}\end{normalsize}\end{center}}}
\newcommand*{\halftitlepageVolumeAcronym}[1]{{\begin{center}\begin{normalsize}{#1}\end{normalsize}\end{center}}}
\newcommand*{\halftitlepageVolumeTranslationTitle}[1]{{\begin{center}\begin{normalsize}{#1}\end{normalsize}\end{center}}}
\newcommand*{\halftitlepageVolumeRootTitle}[1]{{\begin{center}\begin{normalsize}{#1}\end{normalsize}\end{center}}}
\newcommand*{\halftitlepagePublisher}[1]{{\begin{center}\begin{LARGE}{\ArnoProNoLigatures\caps{#1}}\end{LARGE}\end{center}}}

% epigraph
\renewcommand{\epigraphflush}{center}
\renewcommand*{\epigraphwidth}{.7\textwidth}
\newcommand*{\epigraphTranslatedTitle}[1]{\textsc{#1}}%
\newcommand*{\epigraphRootTitle}[1]{\textit{#1}}%
\newcommand*{\epigraphReference}[1]{\footnotesize{#1}}%

% custom commands for html styling classes
\newcommand*{\scnamo}[1]{\begin{center}\textit{#1}\end{center}}
\newcommand*{\scendsection}[1]{\begin{center}\textit{#1}\end{center}}
\newcommand*{\scendsutta}[1]{\begin{center}\textit{#1}\end{center}}
\newcommand*{\scendbook}[1]{\begin{center}\uppercase{#1}\end{center}}
\newcommand*{\scendkanda}[1]{\begin{center}\textbf{#1}\end{center}}
\newcommand*{\scend}[1]{\begin{center}\textit{#1}\end{center}}
\newcommand*{\scuddanaintro}[1]{\textit{#1}}
\newcommand*{\scendvagga}[1]{\begin{center}\textbf{#1}\end{center}}
\newcommand*{\scrule}[1]{\textbf{#1}}
\newcommand*{\scadd}[1]{\textit{#1}}
\newcommand*{\scevam}[1]{\caps{#1}}
\newcommand*{\scspeaker}[1]{\hspace{2em}\textit{#1}}
\newcommand*{\scbyline}[1]{\hspace{2em}\textit{#1}}

% language support
\newjfontfamily\cjk{Noto Serif TC}
\newcommand*{\langlzh}[1]{\cjk{#1}}%

\newcommand*{\langpli}[1]{\textit{#1}}
\newcommand*{\langsan}[1]{\textit{#1}}

% manage and style page header and footer. "fancy" has header and footer, "plain" has footer only
\setlength{\headheight}{19pt}
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[RE,LO]{\thepage}
\fancyfoot[LE,RO]{\footnotesize\lastleftxmark}
\fancyhead[CE]{\setstretch{.85}\MakeLowercase{\textsc{\firstrightmark}}}
\fancyhead[CO]{\setstretch{.85}\MakeLowercase{\textsc{\firstleftmark}}}
\renewcommand{\headrulewidth}{0pt}
\fancypagestyle{plain}{ %
\fancyhf{} % remove everything
\fancyfoot[RE,LO]{\thepage}
\fancyfoot[LE,RO]{\footnotesize\lastleftxmark}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}}

% style footnotes
\setlength{\skip\footins}{1em}

\makeatletter
\newcommand{\@makefntextcustom}[1]{%
    \parindent 0em%
    \thefootnote.\enskip #1%
}
\renewcommand{\@makefntext}[1]{\@makefntextcustom{#1}}
\makeatother

% make latex use document em for parindent, not CMR
\AtBeginDocument{\setlength{\parindent}{1em}}
